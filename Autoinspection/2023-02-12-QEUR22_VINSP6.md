---
title: QEUR22_VINSP6: 　閑話休題～Deltaメトリックスの効果は?(その1)
date: 2023-02-12
tags: ["QEUシステム", "メトリックス", "Julia言語", "SOART", "外観検査", "機械学習"]
excerpt: julia言語とテクノメトリックスを使った外観検査自動機
---

## QEUR22_VINSP6: 　閑話休題～Deltaメトリックスの効果は?(その1)

## ～　一旦、Pythonに退却だ！　～

D先生 ： “まだ下図のステップ2にいると見ていいですか？ひきつづき、SOARTメトリックスからマハラノビス距離を生成しましょう。“

![image3-7-1](/2023-02-12-QEUR22_VINSP6/image3-7-1.jpg)

QEU:FOUNDER ： “連続して画像を読み込み、以下のようなデータが生成できます。”

![image3-7-2](/2023-02-12-QEUR22_VINSP6/image3-7-2.jpg)

D先生 ： “あれ？**「エリアコード(area): 1,2,3」**というのがありますね。 “

![image3-7-3](/2023-02-12-QEUR22_VINSP6/image3-7-3.jpg)

QEU:FOUNDER ： “判別精度を上げるために、マハラノビス距離の学習の**「単位空間」を3種類**にわけました。これでどうだ！！”

D先生 ： “今回は**Deltaという新しい特徴量を加えた**ので、より強力になったでしょう。予測精度はあがりますかね？ “

QEU:FOUNDER ： “やってみましょう。プログラムと結果をドン！！”

```python
#=
   ハイパフォーマンス言語JULIAをやってみる
   Mahalanobis機械学習
=#
using CSV, DataFrames, Plots, Random, Statistics, LinearAlgebra
ENV["columns"] = 1000


path = "soart_mtxout_all.csv"
df = CSV.read(path, DataFrame)
```

![image3-7-4](/2023-02-12-QEUR22_VINSP6/image3-7-4.jpg)

```python
# -----
using Query

# Area_no1
df_area_no1=df|>
　　　　　@filter(_.area==1)|>
　　　　　DataFrame
```

![image3-7-5](/2023-02-12-QEUR22_VINSP6/image3-7-5.jpg)

```python
temp_area_no1 = df_area_no1[!,6:23]
mx_area_no1 = Matrix(temp_area_no1)

# -----
# 散布図を描く(# Area_no1)
scatter(mx_area_no1[:,1],mx_area_no1[:,7],legend=:topleft)
scatter!(mx_area_no1[:,2],mx_area_no1[:,8],legend=:topleft)
scatter!(mx_area_no1[:,3],mx_area_no1[:,9],legend=:topleft)
scatter!(mx_area_no1[:,4],mx_area_no1[:,10],legend=:topleft)
scatter!(mx_area_no1[:,5],mx_area_no1[:,11],legend=:topleft)
scatter!(mx_area_no1[:,6],mx_area_no1[:,12],legend=:topleft)
```

![image3-7-6](/2023-02-12-QEUR22_VINSP6/image3-7-6.jpg)

```python
# Area_no2
df_area_no2=df|>
　　　　　@filter(_.area==2)|>
　　　　　DataFrame

temp_area_no2 = df_area_no2[!,6:23]
mx_area_no2 = Matrix(temp_area_no2)

# -----
# 散布図を描く(# Area_no2)
scatter(mx_area_no2[:,1],mx_area_no2[:,7],legend=:topleft)
scatter!(mx_area_no2[:,2],mx_area_no2[:,8],legend=:topleft)
scatter!(mx_area_no2[:,3],mx_area_no2[:,9],legend=:topleft)
scatter!(mx_area_no2[:,4],mx_area_no2[:,10],legend=:topleft)
scatter!(mx_area_no2[:,5],mx_area_no2[:,11],legend=:topleft)
scatter!(mx_area_no2[:,6],mx_area_no2[:,12],legend=:topleft)
```

![image3-7-7](/2023-02-12-QEUR22_VINSP6/image3-7-7.jpg)

```python
# Area_no3
df_area_no3=df|>
　　　　　@filter(_.area==3)|>
　　　　　DataFrame

temp_area_no3 = df_area_no3[!,6:23]
mx_area_no3 = Matrix(temp_area_no3)

# -----
# 散布図を描く(# Area_no3)
scatter(mx_area_no3[:,1],mx_area_no3[:,7],legend=:topleft)
scatter!(mx_area_no3[:,2],mx_area_no3[:,8],legend=:topleft)
scatter!(mx_area_no3[:,3],mx_area_no3[:,9],legend=:topleft)
scatter!(mx_area_no3[:,4],mx_area_no3[:,10],legend=:topleft)
scatter!(mx_area_no3[:,5],mx_area_no3[:,11],legend=:topleft)
scatter!(mx_area_no3[:,6],mx_area_no3[:,12],legend=:topleft)
```

![image3-7-8](/2023-02-12-QEUR22_VINSP6/image3-7-8.jpg)

QEU:FOUNDER ： “・・・こっ、これは・・・。”

D先生 ： “結局、**散布図のプロットがPIN毎に集約されてしまいました**ね。これでは計算したマハラノビス距離に異常検出の機能はあるんですか？ マハラノビス距離を適用するには、学習データが「均質」であることが前提です。“

![image3-7-9](/2023-02-12-QEUR22_VINSP6/image3-7-9.jpg)

D先生 ： “マハラノビス距離の理論的な基礎は**「多次元誤差関数（正規分布）」**です。この形は明らかに適用条件に該当していません。“

![image3-7-10](/2023-02-12-QEUR22_VINSP6/image3-7-10.jpg)

QEU:FOUNDER ： “じゃあ、Deltaメトリックスを使うのをやめておく？”

D先生 ： “それは逆でしょう！？これらの散布状態(↑)は**Deltaメトリックスが良い特徴量であることの証拠**なんですから・・・。”

QEU:FOUNDER ： “じゃあ、Julia言語による開発は一旦中断し、Pythonに戻って開発しましょう。Python言語を使えば、とれる手段はJulia言語よりも多いですし・・・。”

![image3-7-11](/2023-02-12-QEUR22_VINSP6/image3-7-11.jpg)

D先生 ： “前回、**Stochastic-Deterministic-Heuristicの考え方**をまとめておいてよかったですね(笑)。“

QEU:FOUNDER ： “このデータ構造だと、Stochasticな手法だと壁にぶつかるかもしれません。でも、一応、もとの計画の通りに（マハラノビス距離）を計算してみましょう。うまくいかないことを承知の上で・・・。”


## ～　まとめ　～

## ・・・　前回のつづきです　・・・

C部長 : “Stochastic-Deterministic-Heuristicからみた品質管理の見方はわかりました。じゃあ、タグチメソッドは？”

QEU:FOUNDER ： “パラメタ設計は**Stochasticな理論要素（「品質」）でDeterministicなアウトプット**を出します。Deterministicって、「工学」なので「品質工学」と言えます（笑）。でも、相反するカテゴリのモノをむりやりくっつけているので、うまく行くときもあればいかないこともある。”

C部長 : “MT法は？”

QEU:FOUNDER ： “**完全にStochastic**でしょ？妙に、**「奥深い妙技がある」**なんて技術的（あいまいな）な解釈をすると、逆に「いける・いけない」の判断がつかないですよ。結局は多次元正規分布の応用なんだから・・・。”

C部長 : “T法は？”

QEU:FOUNDER ： “独特な方法なので、わかりません（笑）。でも、我々としては機械学習のテクノメトリックスとして使おうとしているから、**個人的な解釈としてはHeuristic**かな？”

C部長 : “我々がやっていることが**Heuristicに向かっている**ことが、よくわかりました。”

